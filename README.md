# アンテナコントローラ用マイコン仕様書
## 使い方
### ローテータコントローラ側の設定
1. ケーブルを接続する
2. 表面スイッチをP.SET、裏面スイッチを下側へセット
3. SPEEDは最大速度で良い

### マイコンの接続
1. 配線を行う
  - 回路図を参照し、Arduinoの下記ピンに接続
    - CTRL_UP: 9
    - CTRL_DOWN: 8
    - EL_POTENTIO: A1
    - CTRL_CW: 2
    - CTRL_CCW: 3
    - EL_POTENTIO: A0
    - GND: GND
    - 基板を作れば、コネクタを差すだけになるだろう
2. Arduino上のUSB経由でコマンドを送信
  - コマンドリストは下記

## 要求整理
  - 指向精度±10度（アンテナ半値幅）
  - PCからEL,AZ指令値を受け取り、その角度まで制御
  - PCから要求されれば、現在角度と指令角度との誤差を通知


## 仕様
### 全般
- 制御周期500ms
- マイコン1つでAZおよびELを同時に制御可能
- パソコンとの通信I/FはUART
  - ボーレート: 9600bps
  - その他はよくある設定で……
- リセットされると、それまでの設定値は全てデフォルトに戻ります
  - 制御目標: AZ=0deg, EL=0deg
  - 許容誤差(±): AZ=5deg, EL=5deg
  - 制御周期: 500 ms

### 通信
- マイコンとPCはUARTで通信する
  - ArduinoはUART-USB変換がオンボードにあるので、USBで良い

#### PCから送信できるコマンド (""は不要, '\n'=0x0a(LF))
1. "G\n"
  - 現在の情報を取得
  - 下記の行がシリアルで帰ってくる
    - G,[AZの現在角度],[ELの現在角度],[AZの現在目標値],[ELの現在目標値],[AZの現在誤差],[ELの現在誤差],[現在制御周期]\n
      - 角度関連はdeg、周期はmsです
  - 例: 情報を取得
```
  G\n
  → G,40,29,40,30,0,1,500\n （マイコンからの返答）
```
2. "T,[AZ],[EL]\n"
  - 制御の目標値(Target)を設定する
  - [AZ]: 方位角 -180から180度の整数
    - ローテータ上の表示は0~360度となっているので、ご注意
    - 180から360度を-180から0度へ写している
  - [EL]: 高度角 -10から110度の整数
  - 範囲外の整数を指定した場合は、無視される（目標値は変わらない）
  - 例: 目標をAZ=30deg、EL=50degに設定する
```
  T,30,50\n
```
3. "E,[AZ許容誤差],[EL許容誤差]\n"
  - 制御の許容誤差(Error)を設定する
  - 例: 許容誤差を両軸とも3degに設定する
```
  E,3,3\n
```
4. "F,[制御周期(ms)]\n"
  - 制御周期(Frequency)を設定する
  - 例: 500ms毎に制御を実行する
```
  F,500\n
```

### 配線
- 6芯ケーブルアサインメント
  - 1:茶 , 2:黄 , 3:緑 , 4:赤 , 5:白 , 6:黒
    1. POSITIONING
    2. CW(DOWN)
    3. GND
    4. 13VDC
    5. CCW(UP)
    6. SPEED
